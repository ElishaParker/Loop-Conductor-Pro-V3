<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>LoopConductor Pro v3.1</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <h1>üéµ LoopConductor Pro v3.1</h1>

  <div class="global-controls">
    <label>Master Volume:</label>
    <input id="masterVolume" type="range" min="0" max="1" step="0.01" value="0.8" />
    <button id="playAll">‚ñ∂ Play All</button>
    <button id="stopAll">‚èπ Stop All</button>
    <button id="addTrack">‚ûï Add Track</button>
  </div>

  <div id="trackContainer" class="track-container"></div>

  <script type="module">
    import { createTrack, playAll, stopAll, setGlobalVolume } from './loopconductor.js';

    const container = document.getElementById('trackContainer');
    const addBtn = document.getElementById('addTrack');
    const playAllBtn = document.getElementById('playAll');
    const stopAllBtn = document.getElementById('stopAll');
    const masterVolSlider = document.getElementById('masterVolume');

    let tracks = [];

    function updateTitles() {
      tracks.forEach((track, i) => {
        const title = track.querySelector('.track-title');
        if (title) title.textContent = 'Track ' + (i + 1);
      });
    }

    addBtn.onclick = () => {
      const lastSettings = tracks.length ? tracks[tracks.length - 1].dataset.settings : null;
      const newTrack = createTrack(container, lastSettings);
      tracks.push(newTrack);
      updateTitles();
    };

    playAllBtn.onclick = () => playAll(tracks);
    stopAllBtn.onclick = () => stopAll(tracks);
    masterVolSlider.oninput = (e) => setGlobalVolume(parseFloat(e.target.value));

    addBtn.click();
  </script>
</body>
</html>
