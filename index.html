<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Loop Conductor Pro vFinal</title>
<link rel="stylesheet" href="style.css" />
</head>
<body>
<!-- Click Overlay -->
<div id="clickOverlay">
<h2>Click anywhere to begin</h2>
<p>Initializing the Loop Conductor Engine...</p>
</div>

<!-- Splash Screen -->
<div id="splash">
<div id="splashContent">
<h1>üéµ Loop Conductor Pro v3.3</h1>
<p>Initializing Audio Engine‚Ä¶</p>
<div id="loadingBar"><div id="loadingProgress"></div></div>
<p class="donate">
Support open development:
<a href="https://paypal.me/iamvibration" target="_blank">paypal.me/iamvibration</a>
</p>
</div>
</div>

<!-- Main App -->
<div id="mainApp" style="display:none;">
<h1>Loop Conductor Pro v3.3</h1>
<div class="global-controls">
<label>Master Volume:</label>
<input id="masterVolume" type="range" min="0" max="1" step="0.01" value="0.8" />
<button id="playAll">‚ñ∂ Play All</button>
<button id="stopAll">‚èπ Stop All</button>
<button id="addTrack">‚ûï Add Track</button>
</div>

<div id="trackContainer" class="track-container"></div>

<footer>
Loop Conductor Pro v3.3 ‚Äî ¬© 2025 Elisha B. Parker
<a href="https://github.com/ElishaParker/Loop-Conductor-Pro-V3" target="_blank">GitHub</a>
</footer>
</div>

<!-- Main JS -->
<script type="module">
import {
createTrack, playAll, stopAll, setGlobalVolume, initializeAudio
} from "./loopconductor.js";

const splash = document.getElementById("splash");
const mainApp = document.getElementById("mainApp");
const progress = document.getElementById("loadingProgress");
const clickOverlay = document.getElementById("clickOverlay");
let audioReady = false;

async function initApp() {
clickOverlay.style.display = "flex";

document.body.addEventListener("click", async function startOnce() {
document.body.removeEventListener("click", startOnce);
clickOverlay.classList.add("fade-out");

try {
await initializeAudio();
audioReady = true;
console.log("‚úÖ Audio engine initialized");
setTimeout(() => {
clickOverlay.style.display = "none";
startSplash();
}, 800);
} catch (err) {
console.error("Audio initialization failed:", err);
}
});
}

function startSplash() {
let pct = 0;
const intv = setInterval(() => {
pct += 2;
progress.style.width = pct + "%";
if (pct >= 100) {
clearInterval(intv);
splash.classList.add("fade-out");
setTimeout(() => {
splash.style.display = "none";
mainApp.style.display = "block";
if (audioReady) {
bootMain();
applyScreenScale(0.63); // ‚Üê trigger scaling once loaded
}
}, 1000);
}
}, 140);
}

function bootMain() {
const container = document.getElementById("trackContainer");
const addBtn = document.getElementById("addTrack");
const playBtn = document.getElementById("playAll");
const stopBtn = document.getElementById("stopAll");
const masterVol = document.getElementById("masterVolume");
const tracks = [];

const updateTitles = () => {
tracks.forEach((t, i) =>
t.querySelector(".track-title").textContent = "Track " + (i + 1)
);
};

addBtn.onclick = () => {
if (!audioReady) return;
const lastSettings = tracks.length ? tracks[tracks.length - 1].dataset.settings : null;
const newTrack = createTrack(container, lastSettings);
tracks.push(newTrack);
updateTitles();
};

playBtn.onclick = () => playAll(tracks);
stopBtn.onclick = () => stopAll(tracks);
masterVol.oninput = e => setGlobalVolume(parseFloat(e.target.value));

addBtn.click(); // auto-create first track
}

window.addEventListener("load", initApp);
</script>

<!-- üéõ Screen Controller (visual scaling to 63%) -->
<script>
function applyScreenScale(targetScale = 0.63) {
  const app = document.getElementById('mainApp');
  if (!app) return;

  app.style.transformOrigin = 'top left';
  app.style.transform = `scale(${targetScale})`;
  app.style.transition = 'transform 0.4s ease';

  // Align to left edge
  app.style.marginLeft = '0';
}

/* Reapply on load and resize */
window.addEventListener('load', () => applyScreenScale(0.63));
window.addEventListener('resize', () => applyScreenScale(0.63));
</script>
</body>
</html>
